#!/usr/bin/env python3
#
# Author: Yipeng Sun
# License: BSD 2-clause
# Last Change: Thu May 13, 2021 at 06:53 PM +0200

import uproot

from pyTuplingUtils.utils import extract_uid
from pyTuplingUtils.parse import single_ntuple_parser_no_output


def parse_input(descr='''
dump runNumber-eventNumber id for all events, and count number of unique events.
'''):
    parser = single_ntuple_parser_no_output(descr)

    parser.add_argument('--runNumber',
                        nargs='?',
                        default='runNumber',
                        help='''
branch name contains runNumber.''')

    parser.add_argument('--eventNumber',
                        nargs='?',
                        default='eventNumber',
                        help='''
branch name contains eventNumber.''')

    return parser


if __name__ == '__main__':
    args = parse_input().parse_args()
    ntp = uproot.open(args.ref)

    _, _, num_of_evt, num_of_ids, num_of_dupl_ids, num_of_evt_w_dupl_id = \
        extract_uid(ntp, args.ref_tree, args.runNumber, args.eventNumber)
    print('Num of events: {}, Num of IDs: {}, Num of UIDs: {}'.format(
        num_of_evt, num_of_ids, num_of_ids-num_of_dupl_ids))
    print('Num of duplicated IDs: {}, Num of duplicated events: {}, duplicate rate: {:.2f}%'.format(
        num_of_dupl_ids, num_of_evt_w_dupl_id,
        num_of_evt_w_dupl_id/num_of_evt*100))
